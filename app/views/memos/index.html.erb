<%= render "shared/header"%>
<%= render "shared/flash_message"%>
<div class="memo-page">
  <div class="memo-title"><%= @user.nickname %>のトレメモ</div>
  <div class="memo-new-page-btn">
    <div class="search-btn">
      <%= search_form_for @q, url: request.path, id: 'memo-search-form' do |f| %>
        <div class="form-group d-flex justify-content-center">
          <%= f.date_field :start_time_cont, include_blank: true, class: 'form-control col-3' %>
          <%= f.search_field :training_content_cont, placeholder: "キーワード(種目名)", class: 'form-control col-5' %>
          <%= button_tag type: 'submit' do %>
            <i class="fa fa-search search-btn-icon"></i>
          <% end %>
        </div>
        <div class="text-right mr-3">
          <%= link_to '検索条件クリア', request.path, class:"btn btn-info" %>
        </div>
      <% end %>
    </div>
  </div>
  <%= month_calendar events: @memos do |date, memos| %>
    <%= date.day %>
    <% memos.each do |memo| %>
      <% if memo.user_id == current_user.id %>
          <%= link_to memo.training_content.strip.slice(0) + "/", edit_user_memo_path(@user, memo), class: "memo-text" %>
      <% end %>
    <% end %>
  <% end %>
  <div class="search-counts">表示件数<%= @memos.total_count %>件</div>
  <table class="table table-bordered mb-3">
    <thead class="thead-dark">
      <tr>
        <th scope="col">日付</th>
        <th scope="col">種目</th>
        <th scope="col">重さ</th>
        <th scope="col">回数</th>
        <th scope="col">セット数</th>
        <th scope="col"></th>
      </tr>
    </thead>
    <% @memos.each do |memo| %>
      <% if memo.user_id == current_user.id %>
        <tbody class="table-striped">
          <tr>
            <td><%= memo.start_time.strftime("%Y-%m-%d") %></td>
            <td>
              <%= link_to memo.training_content, edit_user_memo_path(@user, memo), class: "memo-text" %>
            </td>
            <td><%= memo.weight %>kg</td>
            <td><%= memo.training_time %>reps</td>
            <td><%= memo.set_count.name %>sets</td>
            <td>
              <%= link_to user_memo_path(@user, memo), method: :delete, data: { confirm: "本当に削除しマッスルか？" } do %>
                <i class="far fa-trash-alt"></i>
              <% end %>
            </td>
          </tr>
        </tbody>
      <% end %>
    <% end %>
  </table>
  <%= paginate @memos %>
  <%= link_to new_user_memo_path(current_user.id) do %>
    <i class="fas fa-plus fa-4x add-training"></i>
  <% end %>
</div>